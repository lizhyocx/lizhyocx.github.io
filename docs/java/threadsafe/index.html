<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"><meta property="og:title" content="线程安全" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://example.org/docs/java/threadsafe/" />

<title>线程安全 | Java面试指南</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.1b994bd28c6ce2255f069b6bf6837b4d396307637fc48d61dcb2a6caac26e031.css" integrity="sha256-G5lL0oxs4iVfBptr9oN7TTljB2N/xI1h3LKmyqwm4DE=">


<script defer src="/search.min.9d665d3439e5b9c8168e3c319761b230e5704050476d5fee8b3952e0921cae08.js" integrity="sha256-nWZdNDnlucgWjjwxl2GyMOVwQFBHbV/uizlS4JIcrgg="></script>

<link rel="alternate" type="application/rss+xml" href="http://example.org/docs/java/threadsafe/index.xml" title="Java面试指南" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  <a href="http://example.org/"><span>Java面试指南</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" placeholder="Search" id="book-search-input" maxlength="64" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>





    

  
  





 
  
    




  
  <ul>
    
      
        

  <li >
    
      <span>Java基础</span>
    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/java/gc/" >
      GC
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/java/io/" >
      IO
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/java/jvm/" >
      JVM
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/java/threadsafe/"  class="active">
      线程安全
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/java/threadpool/" >
      线程池
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/java/collection/" >
      集合
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      <span>WEB</span>
    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/web/html/" >
      HTML
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/web/http/" >
      HTTP
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/web/front/" >
      前端框架
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      <span>中间件</span>
    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/middleware/nosql/" >
      NoSQL
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/middleware/search/" >
      搜索引擎
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/middleware/service/" >
      服务中间件
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/middleware/mq/" >
      消息队列
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/middleware/cache/" >
      缓存
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      <span>基础技术</span>
    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/basic/struct/" >
      数据结构
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/basic/system/" >
      系统
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/basic/encode/" >
      编码&amp;压缩
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/basic/design/" >
      设计模式
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      <span>安全</span>
    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/security/web/" >
      Web安全
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/security/interface/" >
      接口和数据安全
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      <span>数据库</span>
    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/db/base/" >
      SQL基础
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/db/senior/" >
      SQL高级
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      <span>框架技术</span>
    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/framework/guava/" >
      Guava
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/framework/mybatis/" >
      MyBatis
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/framework/spring/" >
      Spring
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/framework/springmvc/" >
      SpringMVC
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      <span>网络和分布式</span>
    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/distribute/distribute/" >
      分布式
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/distribute/network/" >
      网络基础
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
  </ul>
  



  </li>


      
    
  </ul>
  



  











</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>

    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" alt="Menu" />
  </label>
  <strong>线程安全</strong>
</header>

      
<article class="markdown">

<h3 id="线程安全的定义">线程安全的定义</h3>

<ul>
<li><p>多线程访问时，采用了加锁的机制，当一个线程操作该类的某个数据时，进行保护，其他线程不能进行访问直到该线程操作完，其他线程才可以使用。不会出现数据不一致或数据污染。</p>

<h3 id="死锁-场景-如何解决">死锁，场景，如何解决</h3></li>

<li><p>死锁是指当多个进程因竞争资源而造成的一种僵局（互相等待），若无外力作用，这些进行都将无法向前推进。</p></li>

<li><p>死锁产生的原因：</p>

<ul>
<li>系统资源的竞争：系统资源的竞争导致系统资源不足，以及资源分配不当，导致死锁。</li>
<li>进程运行推进顺寻不合适：进程在运行过程中，请求和释放资源的顺序不当，会导致死锁。</li>
</ul></li>

<li><p>死锁的必要条件：</p>

<ul>
<li>互斥条件：一个资源每次只能被一个进程使用，即在一段时间内某资源仅为一个进程所占用。此时若有其他进程请求该资源，则请求进程只能等待。</li>
<li>请求保持条件：进行已经保持了至少一个资源，但又提出了新的资源请求，而该资源已被其他进程占有，此时请求进行被阻塞，但对自己已获得的资源保持不放。</li>
<li>不可剥夺条件：进行所获得的资源在未使用完毕之前，不能被其他进程强行夺走，即只能由获得该资源的进程自己来释放（只能是主动释放）。</li>
<li>循环等待条件：若干进程间形成首尾相接循环等待资源的关系。</li>
</ul></li>

<li><p>死锁的排查：</p>

<ul>
<li>当出现死锁的时候，一般情况下会出现响应超时等现象。如果JVM出现死锁，可以通过jstack命令打印出栈信息，一般如果存在死锁可以在打印出的信息中看到Dead Lock字样。再通过发生死锁的线程id查看现场栈，即可定位到发生死锁的代码。</li>
<li>当数据库出现死锁时，数据库会阻止执行线程继续死锁，中断执行，并向客户端抛出死锁的错误信息，分析时，可以通过分析数据库binlog，查看抛出死锁错误的时候，是哪个sql导致出现的死锁。在Mysql InnoDB引擎中，使用的是行级锁，行级锁不锁记录，锁索引。如果一条SQL用到了主键索引，mysql会锁住主键索引，如果用到了非主键索引，mysql会先所锁住非主键索引，再锁住主键索引。当一条SQL通过非主键索引更新，另一条SQL通过主键更新非主键索引字段就可能会造成死锁。</li>
</ul></li>
</ul>

<h3 id="java中如何给对象加锁">Java中如何给对象加锁</h3>

<ul>
<li>通过synchronized关键字加锁，一般用在方法上或同步代码块，加在静态方法上时，锁定的时类对象，加载非静态方法上，锁定的是调用该方法的对象。不需要手动释放锁，由JVM控制。JVM对synchronized进行了优化，加锁效果提升很多。当没有其他线程抢占资源时，加的锁是偏向锁，同一个线程访问，不需要尝试获取锁，效率最高。一旦出现了其他线程尝试抢占资源，锁就会升级为轻量级锁。如果没有获取到锁，会进行一定次数的自旋，也许马上就能获取到锁，避免线程切换。但当自旋一定次数后，仍获取不到锁，就会升级为重量级锁。</li>
<li>通过ReentrankLock加锁，需要手动加锁，手动释放，一般会把释放锁放到finally中，避免出现异常导致锁不会被释放</li>
</ul>

<h2 id="java加锁的原理">Java加锁的原理</h2>

<h2 id="自旋锁-阻塞锁-重入锁的基本原理">自旋锁、阻塞锁、重入锁的基本原理</h2>

<h2 id="常用的原子类">常用的原子类</h2>
</article>

      

      
    </div>

    
  

  <aside class="book-toc level-6 fixed">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#线程安全的定义">线程安全的定义</a></li>
<li><a href="#死锁-场景-如何解决">死锁，场景，如何解决</a></li>
<li><a href="#java中如何给对象加锁">Java中如何给对象加锁</a></li>
</ul></li>
<li><a href="#java加锁的原理">Java加锁的原理</a></li>
<li><a href="#自旋锁-阻塞锁-重入锁的基本原理">自旋锁、阻塞锁、重入锁的基本原理</a></li>
<li><a href="#常用的原子类">常用的原子类</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
</body>

</html>
